<!DOCTYPE html>
<html>
<head>
	<title>Stored XSS Demonstration</title>
</head>
<body>
	<form>
		<label for="message">Enter a message:</label><br>
		<textarea id="message" name="message" rows="4" cols="50"></textarea><br>
		<input type="button" value="Submit" onclick="submitMessage()">
	</form>
	<div id="display"></div>
    <script>
        function submitMessage() {
            var message = document.getElementById("message").value;
            localStorage.setItem("storedMessage", message);
            displayMessage();
        }
    
        function displayMessage() {
            var message = localStorage.getItem("storedMessage");
            document.getElementById("display").innerHTML = message;
    
            // Check if the storedMessage contains a script tag
            if (message.includes("<script>")) {
                // If so, set the alertMessage variable
                var alertMessage = "HACKED! Your data has been stolen!";
                
                // Add an event listener for the beforeunload event
                window.addEventListener("beforeunload", function(event) {
                    localStorage.setItem("alertMessage", alertMessage);
                    displayAlert();
                });
            }
        }
    
        function displayAlert() {
            var alertMessage = localStorage.getItem("alertMessage");
            alert(alertMessage);
    displayMessage();
        }
    
        // Check if the alertMessage is set in the local storage
        if(localStorage.getItem("alertMessage")) {
            displayAlert();
        }
        else {
            displayMessage();
        }
    </script>
</body>
</html>
